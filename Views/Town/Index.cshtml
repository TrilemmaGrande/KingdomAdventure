@{
    ViewData["Title"] = "Town Area";
}
@model Town

<div class="text-center">
    <h1 class="display-4">
        Welcome to
        @if (Model.TownName is null)
        {
            @:Town
        }
        else
        {
            @Model.TownName
        }
    </h1>
    @if (Model.TownName is null)
    {
        <a asp-action="CreateNewTown">Create Town</a>
    }
    else
    {
        <h3>Buildings in Town:</h3>
        @foreach (var dataset in Model.TownBuildings.Where(a => a.Amount > 0))
        {
            @:------------------------------------------- <br />
            <h5>@dataset.Building.BuildingName @dataset.Amount </h5>
            foreach (var ressource in dataset.Building.BuildingRessourcesCosts)
            {
                if (dataset.Building.Population < Model.TownRessources.FirstOrDefault(i => i.Ressource.RessourceName == "PopulationMax").Amount
                    - Model.PopulationUsed)
                {
                    break;
                }
                if (ressource.Amount > Model.TownRessources.FirstOrDefault(i => i.RessourceID == ressource.RessourceID).Amount)
                {
                    break;
                }
                else
                {
                    <a asp-action="AddBuilding" asp-route-id="@dataset.BuildingID">Increase Amount</a>
                }
            }
            <br />
            @:Produces:
            <br />
            foreach (var productionRessource in dataset.Building.ProducingRessources)
            {
                @:<p>@productionRessource.Amount @productionRessource.Ressource.RessourceName</p>
            }
            <br />
            @:Consumes:
            <br />
            if (dataset.Building.ConsumingRessources.Count > 0)
            {

                foreach (var consumingRessources in dataset.Building.ConsumingRessources)
                {
                    @:<p>@consumingRessources.Amount @consumingRessources.Ressource.RessourceName </p>
                }
            }
            else
            {
                @:<p>nothing</p>
            }
            <br />
            @:Population:
            <br />
            @:<p>@dataset.Building.Population</p>


            <br />

        }

        <h3>Buildings to build:</h3>
        @foreach (var dataset in Model.TownBuildings.Where(a => a.Amount == 0))
        {
            @:------------------------------------------- <br />
            @:<h5>@dataset.Building.BuildingName</h5>
            foreach (var ressource in dataset.Building.BuildingRessourcesCosts)
            {
                if (dataset.Building.Population < Model.TownRessources.FirstOrDefault(i => i.Ressource.RessourceName == "PopulationMax").Amount
                    - Model.PopulationUsed)
                {
                    break;
                }
                if (ressource.Amount > Model.TownRessources.FirstOrDefault(i => i.RessourceID == ressource.RessourceID).Amount)
                {
                    break;
                }
                else
                {
                    <a asp-action="AddBuilding" asp-route-id="@dataset.BuildingID">Build</a>
                }
            }
            <br />
            @:Can Produce:
            <br />
            foreach (var productionRessource in dataset.Building.ProducingRessources)
            {
                @:<p>@productionRessource.Amount @productionRessource.Ressource.RessourceName</p>
            }
            <br />
            @:Will Consume:
            <br />
            if (dataset.Building.ConsumingRessources.Count > 0)
            {
                foreach (var consumingRessources in dataset.Building.ConsumingRessources)
                {
                    @:<p>@consumingRessources.Amount @consumingRessources.Ressource.RessourceName</p>
                }
            }
            else
            {
                @:<p>nothing</p>
            }
            <br />
            @:Ressources needed to build:
            <br />
            foreach (var ressourceCosts in dataset.Building.BuildingRessourcesCosts)
            {
                @:<p>@ressourceCosts.Amount @ressourceCosts.Ressource.RessourceName</p>
            }
            <br />
            @:Place in Population :
            <br />
            @:<p>@dataset.Building.Population</p>


            <br />
        }
    }
</div>
